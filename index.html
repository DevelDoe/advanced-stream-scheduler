<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Advanced Stream Scheduler</title>
        <style>
            :root {
                --bg: #1b1f24;
                --panel: #151515;
                --muted: #7a8b99;
                --text: #eaeff5;
                --accent: #4aa3ff;
                --accent-2: #2b6cb0;
                --ok: #1e8e3e;
                --bad: #8e1e1e;
                --chip: #191919;
                --border: #2a2a2a;
            }
            * {
                box-sizing: border-box;
            }
            html,
            body {
                height: 100%;
            }
            body {
                padding: 20px;
                margin: 0 auto;
                background: var(--bg);
                color: var(--text);
                font: 14px/1.35 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
            }
            h1 {
                margin: 0 0 8px;
                font-weight: 800;
                letter-spacing: 0.2px;
            }

            /* ── Hide all scrollbars, keep scrolling ───────────────────────────── */
            * {
                /* Firefox */
                scrollbar-width: none;
                /* Old Edge/IE */
                -ms-overflow-style: none;
            }
            *::-webkit-scrollbar {
                /* Chrome/Safari/Electron */
                width: 0 !important;
                height: 0 !important;
                display: none;
            }
            *::-webkit-scrollbar-thumb,
            *::-webkit-scrollbar-track {
                background: transparent;
            }

            /* (optional) ensure main containers can still scroll without bars */
            html,
            body {
                overflow: auto;
            }
            #log,
            textarea,
            ul,
            .container {
                overflow: auto;
            }

            .container {
                max-width: 1100px;
                margin: 0 auto;
            }

            /* badges */
            .badges {
                display: flex;
                gap: 12px;
                align-items: center;
                margin-bottom: 10px;
            }
            .badge {
                padding: 4px 8px;
                border-radius: 1px;
                background: #333;
                display: inline-flex;
                align-items: center;
                gap: 6px;
            }
            .badge.loading {
                background: #2a2a2a;
                color: #888;
                position: relative;
                overflow: hidden;
            }
            .badge.loading::after {
                content: "";
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
                animation: loading-shimmer 1.5s infinite;
            }
            @keyframes loading-shimmer {
                0% {
                    left: -100%;
                }
                100% {
                    left: 100%;
                }
            }
            #hb {
                opacity: 0.7;
            }

            /* buttons/inputs */
            button {
                background: #222;
                color: var(--text);
                border: 1px solid var(--border);
                padding: 6px 10px;
                border-radius: 1px;
                cursor: pointer;
            }
            button:hover {
                background: #262626;
            }
            button:active {
                transform: translateY(1px);
            }
            button:disabled {
                opacity: 0.6;
                cursor: not-allowed !important;
                background: #2a2a2a !important;
            }
            button:disabled:hover {
                background: #2a2a2a !important;
            }
            
            /* Loading spinner animation for buttons */
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
            
            .loading-spinner {
                display: inline-block;
                width: 12px;
                height: 12px;
                border: 2px solid transparent;
                border-top: 2px solid currentColor;
                border-radius: 50%;
                animation: spin 1s linear infinite;
                margin-right: 6px;
            }
            
            .btn-danger {
                background: #2a1a1a;
                border-color: #3a2323;
            }
            .btn-danger:hover {
                background: #3a2323;
            }
            
            .btn-end-stream {
                background: #8e1e1e !important;
                border-color: #3a2323 !important;
                color: #fff !important;
            }
            .btn-end-stream:hover {
                background: #a52a2a !important;
                border-color: #4a2a2a !important;
            }
            input,
            select,
            textarea {
                background: #101010;
                color: var(--text);
                border: 1px solid var(--border);
                border-radius: 1px;
                padding: 6px 8px;
            }
            textarea {
                resize: vertical;
            }

            /* layout for schedule form */
            .schedule-grid {
                display: grid;
                grid-template-columns: 1.2fr 1fr;
                gap: 10px 14px;
                align-items: start;
                margin: 16px 0;
            }
            .schedule-row {
                display: flex;
                gap: 8px;
                align-items: center;
            }
            .meta-row {
                display: grid;
                grid-template-columns: 1fr;
                gap: 8px;
            }
            .meta-inline {
                display: flex;
                gap: 16px;
                flex-wrap: wrap;
                align-items: flex-start;
            }
            .meta-inline label {
                display: inline-flex;
                align-items: center;
                gap: 6px;
                white-space: nowrap;
            }
            .meta-inline .recurring {
                min-width: 200px;
                flex: 1;
            }
            #description {
                min-height: 110px;
                width: 100%;
            }

            .thumb-row {
                display: flex;
                gap: 8px;
                align-items: center;
            }
            .thumb-row span {
                opacity: 0.8;
            }

            /* upcoming list */
            #upcomingList {
                list-style: none;
                padding: 0;
                margin: 0;
            }

            /* your rowTemplate still uses inline styles; this fallback styles any custom rows too */
            .broadcast-row {
                display: flex;
                flex-direction: column;
                gap: 8px;
                margin: 6px 0;
                padding: 8px;
                border-radius: 1px;
                background: var(--chip);
                border: 1px solid var(--border);
            }

            /* toast + log */
            #toast {
                position: fixed;
                right: 12px;
                bottom: 12px;
                background: #222;
                color: #fff;
                padding: 10px 14px;
                border-radius: 10px;
                opacity: 0;
                transition: opacity 0.2s;
                pointer-events: none;
            }
            #log {
                background: #111;
                color: #9bd;
                padding: 8px;
                border-radius: 1px;
                height: 300px;
                overflow: auto;
                border: 1px solid var(--border);
            }

            .schedule-grid {
                grid-template-columns: 1fr;
            }

            .recurring {
                display: flex;
                flex-direction: column;
                gap: 8px;
                width: 100%;
            }
            .recurring-toggle {
                display: flex;
                align-items: center;
                gap: 8px;
                padding: 5px 10px;
                background: var(--chip);
                border: 1px solid var(--border);
                border-radius: 1px;
                cursor: pointer;
                transition: all 0.2s ease;
                user-select: none;
            }
            .recurring-toggle:hover {
                background: #2a2a2a;
                border-color: var(--accent);
            }
            .recurring-toggle:has(input:checked) {
                background: var(--accent-2);
                border-color: var(--accent);
            }
            .recurring-toggle input[type="checkbox"] {
                accent-color: var(--accent);
                transform: scale(1.1);
            }
            #recurringDays {
                display: none; /* hidden by default */
                padding: 12px;
                background: var(--chip);
                border: 1px solid var(--border);
                border-radius: 4px;
                margin-top: 4px;
            }
            #recurringDays.show {
                display: flex;
                flex-wrap: wrap;
                gap: 12px;
                align-items: center;
            }
            #recurringDays label {
                display: flex;
                align-items: center;
                gap: 6px;
                padding: 6px 10px;
                background: var(--bg);
                border: 1px solid var(--border);
                border-radius: 4px;
                cursor: pointer;
                transition: all 0.2s ease;
                font-size: 13px;
                user-select: none;
            }
            #recurringDays label:hover {
                background: #2a2a2a;
                border-color: var(--accent);
            }
            #recurringDays input[type="checkbox"] {
                accent-color: var(--accent);
                transform: scale(1.1);
            }
            #recurringDays input[type="checkbox"]:checked + span {
                color: var(--accent);
                font-weight: 600;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>Advanced Stream Scheduler</h1>

            <div id="status" class="badges">
                <!-- <div id="scheduler" class="badge loading">Scheduler: Loading...</div> -->
                <div id="youtube" class="badge loading">YouTube API: Loading...</div>
                <div id="obs" class="badge loading">OBS: Loading...</div>
                <!-- <div id="broadcast" class="badge loading">Broadcast: Loading...</div> -->
            </div>

            <div id="upcomingLoading" style="display: none; text-align: center; padding: 20px">
                <div>Loading upcoming broadcasts...</div>
            </div>
            <ul id="upcomingList"></ul>

            <style>
                @keyframes loading-bar {
                    0% {
                        transform: translateX(-100%);
                    }
                    100% {
                        transform: translateX(100%);
                    }
                }
            </style>

            <!-- Scheduling form -->
            <div class="schedule-grid">
                <div class="schedule-row">
                    <input id="title" placeholder="Stream title" style="flex: 1" />
                    <input id="startTime" type="datetime-local" />
                    <button id="scheduleBtn">Schedule Stream</button>
                </div>

               

                <div class="meta-row">
                    <textarea id="description" rows="10" style="width: 100%" placeholder="Description"></textarea>

                    <div class="meta-inline">
                        <label
                            >Visibility
                            <select id="visibility">
                                <option value="public">Public</option>
                                <option value="unlisted">Unlisted</option>
                                <option value="private">Private</option>
                            </select>
                        </label>

                        <label
                            >Latency
                            <select id="latency">
                                <option value="ultraLow" selected>Ultra Low</option>
                                <option value="low">Low</option>
                                <option value="normal">Normal</option>
                            </select>
                        </label>
                        <div class="recurring">
                            <div class="recurring-toggle">
                                <input type="checkbox" id="recurringChk" />
                                <span>🔄 Recurring Stream</span>
                            </div>
                            <div id="recurringDays">
                                <label><input type="checkbox" value="1" /><span>Mon</span></label>
                                <label><input type="checkbox" value="2" /><span>Tue</span></label>
                                <label><input type="checkbox" value="3" /><span>Wed</span></label>
                                <label><input type="checkbox" value="4" /><span>Thu</span></label>
                                <label><input type="checkbox" value="5" /><span>Fri</span></label>
                                <label><input type="checkbox" value="6" /><span>Sat</span></label>
                                <label><input type="checkbox" value="0" /><span>Sun</span></label>
                            </div>
                        </div>
                    </div>

                    <div class="thumb-row">
                        <button id="thumbPickBtn" type="button">Choose Thumbnail</button>
                        <span id="thumbName">No previous thumbnail</span>
                    </div>

                    <!-- <div class="recurring">
                        <label><input type="checkbox" id="recurringChk" /> Recurring</label>
                        <div id="recurringDays">
                            <label><input type="checkbox" value="1" /> Mon</label>
                            <label><input type="checkbox" value="2" /> Tue</label>
                            <label><input type="checkbox" value="3" /> Wed</label>
                            <label><input type="checkbox" value="4" /> Thu</label>
                            <label><input type="checkbox" value="5" /> Fri</label>
                            <label><input type="checkbox" value="6" /> Sat</label>
                            <label><input type="checkbox" value="0" /> Sun</label>
                        </div>
                    </div> -->
                </div>
            </div>

            <div id="toast"></div>
            <pre id="log" style="display: none"></pre>
        </div>

        <!-- OBS Settings Modal -->
        <div id="obsSettingsModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 1000">
            <div
                style="
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: var(--panel);
                    border: 1px solid var(--border);
                    border-radius: 8px;
                    padding: 24px;
                    min-width: 400px;
                "
            >
                <h2 style="margin: 0 0 20px 0">OBS WebSocket Settings</h2>

                <div style="display: flex; flex-direction: column; gap: 16px">
                    <div>
                        <label style="display: block; margin-bottom: 4px">Host:</label>
                        <input id="obsHost" type="text" placeholder="localhost" style="width: 100%" />
                    </div>

                    <div>
                        <label style="display: block; margin-bottom: 4px">Port:</label>
                        <input id="obsPort" type="number" placeholder="4455" style="width: 100%" />
                    </div>

                    <div>
                        <label style="display: block; margin-bottom: 4px">Password (optional):</label>
                        <input id="obsPassword" type="password" placeholder="Leave empty if no password" style="width: 100%" />
                    </div>

                    <div>
                        <label style="display: flex; align-items: center; gap: 8px">
                            <input id="obsEnabled" type="checkbox" checked />
                            Enable OBS WebSocket connection
                        </label>
                    </div>

                    <div style="display: flex; gap: 8px; justify-content: flex-end; margin-top: 20px">
                        <button id="obsTestBtn" style="background: #2a2a2a">Test Connection</button>
                        <button id="obsCancelBtn">Cancel</button>
                        <button id="obsSaveBtn" style="background: var(--accent)">Save</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Credentials Setup Modal -->
        <div id="credentialsModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 1000">
            <div
                style="
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: var(--panel);
                    border: 1px solid var(--border);
                    border-radius: 0px;
                    padding: 24px;
                    min-width: 500px;
                    max-width: 600px;
                "
            >
                <h2 style="margin: 0 0 20px 0">Google OAuth Credentials Setup</h2>

                <div id="credentialsStatus" style="margin-bottom: 20px; padding: 12px; border-radius: 4px; background: #2a2a2a">
                    <div style="font-weight: bold; margin-bottom: 8px">Status: <span id="credentialsStatusText">Checking...</span></div>
                    <div id="credentialsStatusDetails" style="font-size: 13px; opacity: 0.8"></div>
                </div>

                <div id="oauthStatus" style="margin-bottom: 20px; padding: 12px; border-radius: 4px; background: #2a2a2a; display: none;">
                    <div style="font-weight: bold; margin-bottom: 8px; color: #ffaa00;">🔄 OAuth Authentication in Progress</div>
                    <div style="font-size: 13px; opacity: 0.8; margin-bottom: 12px;">
                        Please complete the authentication in your browser. If you need to cancel, click the button below.
                    </div>
                    <button id="oauthCancelBtn" style="background: #8e1e1e; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">
                        Cancel OAuth
                    </button>
                </div>

                <div id="credentialsSetupSteps" style="display: none">
                    <h3 style="margin: 0 0 16px 0">Setup Steps:</h3>
                    <ol style="margin: 0 0 20px 0; padding-left: 20px; line-height: 1.6">
                        <li>Go to <a href="https://console.cloud.google.com/" target="_blank" style="color: var(--accent)">Google Cloud Console</a></li>
                        <li>Create a new project or select an existing one</li>
                        <li>Enable the YouTube Data API v3</li>
                        <li>Go to "Credentials" → "Create Credentials" → "OAuth 2.0 Client IDs"</li>
                        <li>Choose "Desktop application" as the application type</li>
                        <li>Download the credentials file (it will have a random name like "client_secret_123456789-abcdefghijklmnop.apps.googleusercontent.com.json")</li>
                        <li>Select the downloaded file below (you don't need to rename it)</li>
                    </ol>

                    <div style="margin-bottom: 16px">
                        <button id="credentialsPickBtn" style="background: var(--accent)">Select Credentials File</button>
                        <span id="credentialsFileName" style="margin-left: 12px; opacity: 0.8">No file selected</span>
                    </div>

                    <div id="credentialsValidation" style="display: none; margin-bottom: 16px">
                        <div id="credentialsValidationResult" style="padding: 8px; border-radius: 4px"></div>
                    </div>
                </div>

                <div id="credentialsActions" style="display: flex; gap: 8px; justify-content: flex-end; margin-top: 20px">
                    <button id="credentialsClearBtn" style="background: #2a1a1a">Clear Token</button>
                    <button id="credentialsTestBtn" style="background: #2a2a2a">Test Connection</button>
                    <button id="credentialsCancelBtn">Close</button>
                </div>
            </div>
        </div>

        <script src="renderer.js"></script>
    </body>
</html>
